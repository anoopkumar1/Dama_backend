<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Verification</title>
    <link rel="icon" type="image/x-icon" href="/theme/images/favicon.png" />
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />
    <link rel="stylesheet" href="/theme/css/responsive.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/owl.carousel.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/theme/css/min/sweetalert.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <style>
      .digit-group {
        padding: 8px 10px;
        border-radius: 10px;

        width: 200px;
        margin: auto;
      }

      .digit-group input {
        width: 30px;
        height: 30px;
        background-color: #fff;
        border: none;
        outline: none;
        line-height: initial;
        text-align: center;
        font-size: 16px;
        font-weight: 200;
        margin: 0 2px;
        border-bottom: 1px solid #268d84;
        border-radius: 0px !important;
      }

      .verify-resend p i {
        color: #268d84;
      }

      .loginmd .form-group p.forgot-pass span {
        color: #268d84;
      }
    </style>
  </head>

  <body class="bg-color-1">
    <div class="loader loader--active">
      <div class="loader__icon">
        <!-- <div class='pin'></div>
       <div class='pulse'></div> -->
        <img src="/theme/images/loading-buffering.gif" />
      </div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
      <div class="loader__tile"></div>
    </div>

    <div class="loginmd col-md-12 pt-5 pb-5 px-5">
      <form role="form" id="activateAccount" method="post">
        <div class="row">
          <div class="form-group col-md-12 mb-3">
            <h1>Verify Your Email</h1>
            <p class="forgot-pass mt-3">
              Please enter the 4 digits code sent to your email id for
              verification.
            </p>
          </div>
          <div class="col-md-3"></div>
          <div class="col-md-6">
            <div class="react-join-group-otp">
              <div class="digit-group">
                <label for="vCodeOne"></label>
                <input
                  type="tel"
                  class="joinCode"
                  maxlength="1"
                  name="vCodeOne"
                  id="vCodeOne"
                  pattern="\d{1}"
                  required=""
                  onkeyup="tabChange(1)"
                />
                <label for="vCodeTwo"></label>
                <input
                  type="tel"
                  class="joinCode"
                  maxlength="1"
                  name="vCodeTwo"
                  id="vCodeTwo"
                  pattern="\d{1}"
                  required=""
                  onkeyup="tabChange(2)"
                />
                <label for="vCodeThree"></label>
                <input
                  type="tel"
                  class="joinCode"
                  maxlength="1"
                  name="vCodeThree"
                  id="vCodeThree"
                  pattern="\d{1}"
                  required=""
                  onkeyup="tabChange(3)"
                />
                <label for="vCodeFour"></label>
                <input
                  type="tel"
                  class="joinCode"
                  maxlength="1"
                  name="vCodeFour"
                  id="vCodeFour"
                  pattern="\d{1}"
                  required=""
                  onkeyup="tabChange(4)"
                />
              </div>
            </div>
          </div>
          <div class="col-md-3"></div>
          <div class="col-md-3"></div>
          <div class="col-md-6">
            <div class="verify-resend mt-3">
              <p onclick="resendCode()">
                <i class="fa-solid fa-arrow-rotate-left"></i> Resend Code
              </p>
            </div>
          </div>
          <div class="col-md-3"></div>

          <div class="col-md-3"></div>
          <div class="form-group col-md-6">
            <button type="submit" href="/sign-up">
              Verify<span></span><span></span><span></span><span></span
              ><span></span><span></span>
            </button>
            <!-- <a class="btn" href="/sign-up" type="submit">Verify<span></span><span></span><span></span><span></span><span></span><span></span></a> -->
          </div>
          <div class="col-md-3"></div>
        </div>
      </form>
    </div>
  </body>
  <script src="/theme/js/jquery-3.2.1.slim.min.js"></script>
  <script src="/theme/js/popper.min.js"></script>
  <script src="/theme/js/bootstrap.min.js"></script>
  <script src="/theme/js/custom.js"></script>

  <script src="/theme/js/owl.carousel.js"></script>
  <script src="/theme/js/jquery.min.js"></script>
  <script src="/theme/js/sweetalert-min.js" type="text/javascript"></script>
  <script src="/theme/js/main.js"></script>
  <script src="/theme/js/form-validation.min.js"></script>

  <script>
    let digitValidate = function (ele) {
      ele.value = ele.value.replace(/[^0-9]/g, "");
    };

    let tabChange = function (val) {
      let ele = document.querySelectorAll("input");
      if (ele[val - 1].value != "") {
        ele[val].focus();
      } else if (ele[val - 1].value == "") {
        ele[val - 2].focus();
      }
    };
    $(function () {
      $("#activateAccount").validate({
        errorPlacement: function (error, element) {
          $(element)
            .closest("form")
            .find("label[for='" + element.attr("id") + "']")
            .append(error);
        },
        errorElement: "span",
        rules: {
          vCodeOne: {
            required: true,
            minlength: 1,
            maxlength: 1,
            number: true,
          },
          vCodeTwo: {
            required: true,
            minlength: 1,
            maxlength: 1,
            number: true,
          },
          vCodeThree: {
            required: true,
            minlength: 1,
            maxlength: 1,
            number: true,
          },
          vCodeFour: {
            required: true,
            minlength: 1,
            maxlength: 1,
            number: true,
          },
        },
        submitHandler: function () {
          let code = $("#vCodeOne").val();
          code += $("#vCodeTwo").val();
          code += $("#vCodeThree").val();
          code += $("#vCodeFour").val();

          let email = localStorage.getItem("signupEmail");

          $.ajax({
            url: "/activate-account",
            data: "token=" + code + "&email=" + email,
            cache: false,
            processData: false,
            method: "POST",
            type: "POST",
            success: function (_res) {
              let successConfig = {
                title: "Confirmation",
                message: `Your account has been successfully verified.
             Please sign in your account.`,
                type: "success",
              };
              window.location.href = "sign-in";
              KWACHA_MAIN.sweetAlert(successConfig);
              $("#activateAccount").trigger("reset");
            },
            error: function (e) {
              let responseText = JSON.parse(e.responseText);
              let errorConfig = {
                title: "Error",
                message: responseText.message,
                type: "error",
              };
              KWACHA_MAIN.sweetAlert(errorConfig);
            },
          });
        },
      });
    });
    function resendCode() {
      let email = localStorage.getItem("signupEmail");
      $.ajax({
        url: "/resend-activation-code",
        data: "email=" + email,
        cache: false,
        processData: false,
        method: "POST",
        type: "POST",
        success: function (_res) {
          let successConfig = {
            title: "Confirmation",
            message: `Code has been sent to your email.`,
            type: "success",
          };
          KWACHA_MAIN.sweetAlert(successConfig);
        },
        error: function (e) {
          let responseText = JSON.parse(e.responseText);
          let errorConfig = {
            title: "Error",
            message: responseText.message,
            type: "error",
          };
          KWACHA_MAIN.sweetAlert(errorConfig);
        },
      });
    }
  </script>
</html>
